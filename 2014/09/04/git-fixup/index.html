<html>
<head>
  <meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>alecharp&#39;s blog: Git fixup quand on connait pas</title>

  <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:200,600" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" media="screen" href="/css/index.css" />
  <link rel="stylesheet" media="screen" href="/css/syntax.css" />
  <link rel="stylesheet" media="screen" href="/css/font-awesome.min.css" />
</head>

<body>

<navbar>
  <div><a href="/" title="alecharp&#39;s blog">alecharp&#39;s blog</a></div>
  <nav>
    <ul>
      <li>
        <a href="//twitter.com/alecharp" title="alecharp's Twitter"><i class="fa fa-twitter"></i></a>
      </li>
      <li>
        <a href="//github.com/alecharp" title="alecharp's Github"><i class="fa fa-github"></i></a>
      </li>
      <li>
        <a href="/index.xml" title="alecharp&#39;s blog's RSS"><i class="fa fa-rss"></i></a>
      </li>
      <li>
        <a href="//speakerdeck.com/alecharp" title="alecharp's SpeakerDeck"><i class="fa fa-slideshare"></i></a>
      </li>
    </ul>
  </nav>
</navbar>


<main>
  

<article>
  <header>
    <h1>Git fixup quand on connait pas</h1>
    <time pubdate="2014-09-04">
      <i class="fa fa-calendar"></i> 2014-09-04
    </time>
  </header>
  <section>
    

<p>Ça va être court : je vais parler de fixup automatique dans Git.</p>

<h2 id="pourquoi-faire-du-fixup">Pourquoi faire du fixup</h2>

<p>J&rsquo;ai pour habitude de beaucoup faire de fixup sur les rebase interactifs, quand je me rends compte que j&rsquo;ai un état non complet sur l&rsquo;un de mes commits, ce qui arrive souvent. Si c&rsquo;est le dernier commit, un <code>git commit --amend</code> suffit. Si un ou plusieurs commit(s) se sont intercalés entre deux, alors il faudra faire un rebase interactif pour transformer l&rsquo;historique.</p>

<p>J&rsquo;ai pris cette habitude car même s&rsquo;il m&rsquo;arrive d&rsquo;avoir de gros développements, je préfère faire de petits commits, mais au fil de l&rsquo;eau ce n&rsquo;est pas évident, ou alors on oublie quelque chose. Il faut souvent donc retravailler son historique localement avant de le publier.</p>

<h2 id="à-la-main">À la main</h2>

<p>Il fut un temps pas si lointain (le week-end dernier) où je faisais du fixup &lsquo;à la main&rsquo;. Dans ce cas, on fait un <code>git log --oneline</code> pour trouver le SHA1 du commit à compléter, on <code>git add</code> ce que l&rsquo;on a oublié puis on fait <code>git commit -m &quot;fixup SHA1&quot;</code>. Pour modifier réellement le commit, on fait un <code>git rebase -i origin/&lt;branch&gt;</code> pour déplacer le commit là où ça va bien (on s&rsquo;aide du <code>SHA1</code> dans le message du commit) et on modifie son utisation de <code>pick</code> à <code>f(ixup)</code>.</p>

<h2 id="quand-on-connaît">Quand on connaît</h2>

<p>Le truc c&rsquo;est que c&rsquo;est souvent long et chiant : je fais rarement mon rebase sur 4 commits. Mais tout ça peut se faire automatiquement&hellip;</p>

<p>On peut utiliser l&rsquo;option <code>--fixup=&lt;SHA1&gt;</code> sur la commande <code>git commit</code> pour préciser que le commit courant va servir de fixup au commit <code>&lt;SHA1&gt;</code>. Sachant que <code>&lt;SHA1&gt;</code> peut être <code>HEAD~4</code> car il va mettre en message de commit le message du commit à corriger.</p>

<p>Ensuite, l&rsquo;option <code>--autosquash</code> sur le rebase interactif. Elle permet d&rsquo;automatiquement réorganiser les commits dans le rebase interatif pour mettre les commits avec comme message <code>fixup! &lt;SHA1&gt;|&quot;message&quot;</code> après le commit <code>fixup</code>. Donc plus besoin de modifier à la main le placement des commits de correction.</p>

<h2 id="et-voilà">Et Voilà !</h2>

<p>Avec simplement 2 options à des commandes, mon collègue <a href="https://twitter.com/zigarn">Alexandre Garnier</a> m&rsquo;a fait gagner au moins 15min par semaine et des appréhensions en moins !</p>

<p>Du même coup, ça s&rsquo;est retrouvé sur mes alias :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">git config --global alias.fixup <span class="s1">&#39;commit --fixup&#39;</span>
git config --global alias.ri <span class="s1">&#39;rebase -i --autosquash&#39;</span></code></pre></td></tr></table>
</div>
</div>
<p>Je vous conseille fortement d&rsquo;avoir un historique propre lors de votre publication (push). Un historique clair avec des messages de commits correctement formatés permet de lire et comprendre le dépôt de code avec un <code>git log --oneline</code>. Ça en vaut la peine !</p>

  </section>
</article>


</main>

  <footer>
    &copy; Adrien Lecharpentier 2012 - 2017
  </footer>

</body>
</html>

