<html>
<head>
  <meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>alecharp&#39;s blog: My tribute to oh-my-zsh Theme</title>

  <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:200,700" rel="stylesheet" />
  <link rel="stylesheet" media="screen" href="/css/main.css" />
  <link rel="stylesheet" media="screen" href="/css/syntax.css" />
  <link rel="stylesheet" media="screen" href="/css/font-awesome.min.css" />
</head>

<body>

<navbar>
  <div><a href="/" title="alecharp&#39;s blog">alecharp&#39;s blog</a></div>
  <ul>
    <li>
      <a href="//twitter.com/alecharp" title="alecharp's Twitter"><i class="fa fa-twitter"></i></a>
    </li>
    <li>
      <a href="//github.com/alecharp" title="alecharp's Github"><i class="fa fa-github"></i></a>
    </li>
    <li>
      <a href="/index.xml" title="alecharp&#39;s blog's RSS"><i class="fa fa-rss"></i></a>
    </li>
      <li>
        <a href="//speakerdeck.com/alecharp" title="alecharp's SpeakerDeck"><i class="fa fa-slideshare"></i></a>
      </li>
  </ul>
</navbar>


<div id="content">
  

<article>
  <header>
    <h2>My tribute to oh-my-zsh Theme</h2>
  </header>
  <time pubdate="2013-06-25">
    <i class="fa fa-calendar"></i> 2013-06-25
  </time>
  <section>
    

<p>parce qu&rsquo;un prompt qui convient vaux mieux que 1000 mots</p>

<h2 id="rappel">Rappel</h2>

<p>Ne réinventons pas la roue, même pour les descriptions :</p>

<h3 id="zsh">ZSH</h3>

<blockquote>
<p>Zsh is a shell designed for interactive use, although it is also a powerful scripting language.</p>
</blockquote>

<h3 id="oh-my-zsh">oh-my-zsh</h3>

<blockquote>
<p>oh-my-zsh is an open source, community-driven framework for managing your ZSH configuration. It comes bundled with a ton of helpful functions, helpers, plugins, themes, and few things that make you shout…</p>
</blockquote>

<h2 id="oh-my-zsh-theme">oh-my-zsh theme</h2>

<p>Donc graphiquement, voilà à quoi ressemble mon <code>prompt</code>:</p>

<p><img src="/images/2013-06-25-my-tribute-to-oh-my-zsh-theme/screenshot-01.png" alt="oh-my-zsh theme" /></p>

<h3 id="les-bases">Les bases</h3>

<p>Je ne vois pas beaucoup l&rsquo;intérêt d&rsquo;afficher le <code>hostname</code> de la machine courante, étant donné que le <code>prompt</code> en lui-même ne sera jamais que sur ma machine. Sinon, j&rsquo;apprécie le fait de voir l&rsquo;utilisateur ainsi que le dossier courant. Par contre, les commandes que je tape, je préfère qu&rsquo;elles soient écrites sur la ligne du dessous, question de lisibilité.</p>

<p>Donc ça nous donne un <code>prompt</code></p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1</span><span class="lnt">2</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">PROMPT</span><span class="o">=</span><span class="s1">&#39;%{$fg_bold[cyan]%}%n: %{$fg[yellow]%}%04~%{$reset_color%}
</span><span class="s1">» &#39;</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="le-caractère-de-prompt">Le caractère de <code>prompt</code></h3>

<p>Pour se mettre dans le bain : le caractère &ldquo;»&rdquo; change de couleur en fonction de la réussite ou non de la dernière commande. Pour faire ça :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">function</span> prompt_char <span class="o">{</span>
	<span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
		<span class="nb">echo</span> <span class="s2">&#34;%{</span><span class="nv">$fg_bold</span><span class="s2">[red]%}»%{</span><span class="nv">$reset_color</span><span class="s2">%}&#34;</span>
	<span class="k">else</span>
		<span class="nb">echo</span> <span class="s2">&#34;%{</span><span class="nv">$fg_bold</span><span class="s2">[green]%}»%{</span><span class="nv">$reset_color</span><span class="s2">%}&#34;</span>
	<span class="k">fi</span>
<span class="o">}</span>

<span class="nv">PROMPT</span><span class="o">=</span><span class="s1">&#39;%{$fg_bold[cyan]%}%n: %{$fg[yellow]%}%04~%{$reset_color%}
</span><span class="s1">$(prompt_char) &#39;</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="git">Git</h3>

<p>Car c&rsquo;est selon moi le meilleurs (D)VCS sur le marché, je l&rsquo;utilise partout (ce blog, les documentations que j&rsquo;écris, les projets, etc.), je l&rsquo;utilise même pour gérer les dépôts SVN&hellip; Du coup je ne peux me servir que de Git.</p>

<p>Donc pour utiliser correctement Git, il faut voir ce que l&rsquo;on fait:</p>

<ul>
<li>la branche sur laquelle on travaille,</li>
<li>la branche distante (si elle existe) et la différence avec la branche courante,</li>
<li>l&rsquo;état du workspace, de l&rsquo;index ainsi que du repository local.</li>
</ul>

<p>Ceci n&rsquo;est pas trop compliqué car avec oh-my-zsh, il y a la fonction <code>git_prompt_status</code> qui permet de montrer ces informations. Il est uniquement nécessaire de mettre en place des variables :</p>

<table class="table">
    <thead>
    <tr>
        <th>Symbole</th>
        <th>Description</th>
        <th>Variable</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><strong>-</strong></td>
        <td>Un fichier a été supprimé du local repository</td>
        <td><em>ZSH_THEME_GIT_PROMPT_DELETED</em></td>
    </tr>
    <tr>
        <td><strong>*</strong></td>
        <td>Un fichier est modifié dans le workspace</td>
        <td><em>ZSH_THEME_GIT_PROMPT_MODIFIED</em></td> </tr>
    <tr>
        <td><strong>+</strong></td>
        <td>Un fichier a été ajouté dans l'index du repository</td>
        <td><em>ZSH_THEME_GIT_PROMPT_ADDED</em></td>    </tr>
    <tr>
        <td><strong>?</strong></td>
        <td>Un fichier n'est ni dans l'index ni dans le local repository</td>
        <td><em>ZSH_THEME_GIT_PROMPT_UNTRACKED</em></td>    </tr>
    </tbody>
</table>

<p>Je veux maintenant pouvoir voir la branche sur laquelle je travaille :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">ref</span><span class="o">=</span><span class="k">$(</span><span class="nb">command</span> git symbolic-ref HEAD <span class="m">2</span>&gt; /dev/null<span class="k">)</span> <span class="o">||</span> <span class="se">\
</span><span class="se"></span><span class="nv">ref</span><span class="o">=</span><span class="k">$(</span><span class="nb">command</span> git rev-parse --short HEAD <span class="m">2</span>&gt; /dev/null<span class="k">)</span> <span class="o">||</span> <span class="k">return</span>

<span class="nv">STATUS</span><span class="o">=</span><span class="si">${</span><span class="nv">ZSH_THEME_GIT_PROMPT_PREFIX</span><span class="si">}</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="nv">$STATUS</span><span class="si">${</span><span class="nv">ZSH_THEME_GIT_PROMPT_BRANCH_PREFIX</span><span class="si">}${</span><span class="nv">ref</span><span class="p">#refs/heads/</span><span class="si">}${</span><span class="nv">ZSH_THEME_GIT_PROMPT_BRANCH_SUFFIX</span><span class="si">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Je veux ensuite avoir la branche distante :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">remote</span><span class="o">=</span><span class="si">${</span><span class="k">$(</span><span class="nb">command</span> git rev-parse --verify <span class="si">${</span><span class="nv">hook_com</span><span class="p">[branch]</span><span class="si">}</span>@<span class="o">{</span>upstream<span class="o">}</span> --symbolic-full-name <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="p">/refs</span><span class="se">\/</span><span class="nv">remotes</span><span class="se">\/</span><span class="si">}</span>
<span class="k">if</span> <span class="o">[[</span> -n <span class="si">${</span><span class="nv">remote</span><span class="si">}</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nv">STATUS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$STATUS</span><span class="s2"> </span><span class="si">${</span><span class="nv">remote</span><span class="p">#/refs/remote</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="k">fi</span></code></pre></td></tr></table>
</div>
</div>

<p>Puis après je veux savoir l&rsquo;état de la branche locale par rapport à la branche distante</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">ahead</span><span class="o">=</span><span class="k">$(</span><span class="nb">command</span> git rev-list <span class="si">${</span><span class="nv">hook_com</span><span class="p">[branch]</span><span class="si">}</span>@<span class="o">{</span>upstream<span class="o">}</span>..HEAD <span class="m">2</span>&gt;/dev/null <span class="p">|</span> wc -l <span class="p">|</span> tr -d <span class="s1">&#39; &#39;</span><span class="k">)</span>
<span class="nv">behind</span><span class="o">=</span><span class="k">$(</span><span class="nb">command</span> git rev-list HEAD..<span class="si">${</span><span class="nv">hook_com</span><span class="p">[branch]</span><span class="si">}</span>@<span class="o">{</span>upstream<span class="o">}</span> <span class="m">2</span>&gt;/dev/null <span class="p">|</span> wc -l <span class="p">|</span> tr -d <span class="s1">&#39; &#39;</span><span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$ahead</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">STATUS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$STATUS</span><span class="s2"> </span><span class="nv">$ahead$ZSH_THEME_GIT_PROMPT_AHEAD_REMOTE</span><span class="s2">&#34;</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$behind</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">STATUS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$STATUS</span><span class="s2"> </span><span class="nv">$ZSH_THEME_GIT_PROMPT_BEHIND_REMOTE_PREFIX$behind$ZSH_THEME_GIT_PROMPT_BEHIND_REMOTE</span><span class="s2"> ZSH_THEME_GIT_PROMPT_BEHIND_REMOTE_SUFFIX&#34;</span>
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$ahead</span> -eq <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$behind</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
	<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$STATUS</span><span class="s2"> =&#34;</span>
<span class="k">fi</span></code></pre></td></tr></table>
</div>
</div>

<p>Donc on met tout ce code dans une fonction, ainsi on peut l&rsquo;appeler sur notre <code>prompt</code>. Petite nuance, je le mets sur le <code>rprompt</code> pour que le <code>prompt</code> avec ou sans information Git ne bouge.</p>

<p>Vous pouvez remarquer que j&rsquo;ai usé et abusé des variables pour mettre les messages : c&rsquo;est pour toi public ! Non sans blague, ça permet de pouvoir changer les caractères / icônes utilisés sans toucher au code qui permet des les afficher&hellip; oui oui c&rsquo;est très MVC tout ça&hellip; bref</p>

<h2 id="conclusion">Conclusion</h2>

<p>Vous pouvez trouver sur mon <a href="https://github.com/alecharp/oh-my-zsh/blob/alecharp-theme/themes/alecharp.zsh-theme">github</a> le fichier complet de ce code.</p>

<p>Les retours, commentaires, avis sont évidemment les bienvenus !</p>

  </section>
</article>


</div>

  <footer>
    &copy; Adrien Lecharpentier 2012
  </footer>

</body>
</html>

