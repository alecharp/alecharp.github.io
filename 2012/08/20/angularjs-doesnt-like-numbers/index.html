<html>
<head>
  <meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>alecharp&#39;s blog: AngularJS doesn&#39;t like numbers</title>

  <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:200,700" rel="stylesheet" />
  <link rel="stylesheet" media="screen" href="/css/main.css" />
  <link rel="stylesheet" media="screen" href="/css/syntax.css" />
  <link rel="stylesheet" media="screen" href="/css/font-awesome.min.css" />
</head>

<body>

<navbar>
  <div><a href="/" title="alecharp&#39;s blog">alecharp&#39;s blog</a></div>
  <ul>
    <li>
      <a href="//twitter.com/alecharp" title="alecharp's Twitter"><i class="fa fa-twitter"></i></a>
    </li>
    <li>
      <a href="//github.com/alecharp" title="alecharp's Github"><i class="fa fa-github"></i></a>
    </li>
    <li>
      <a href="/index.xml" title="alecharp&#39;s blog's RSS"><i class="fa fa-rss"></i></a>
    </li>
      <li>
        <a href="//speakerdeck.com/alecharp" title="alecharp's SpeakerDeck"><i class="fa fa-slideshare"></i></a>
      </li>
  </ul>
</navbar>


<div id="content">
  

<article>
  <header>
    <h2>AngularJS doesn&#39;t like numbers</h2>
  </header>
  <time pubdate="2012-08-20">
    <i class="fa fa-calendar"></i> 2012-08-20
  </time>
  <section>
    

<p>Petite expérience sur angularJS</p>

<p>Il y a peu, un collègue (<a href="http://twitter.com/OlivierCroisier">Olivier Croisier</a>)
m&rsquo;a montré le framework JS de Google <a href="http://www.angularjs.org/">AngularJS</a>.</p>

<p>Pour un projet personnel en RESTFull / JS j&rsquo;utilisais jusque là <a href="http://knockoutjs.com/">KnockoutJS</a>
pour faire le date-binding mais je me suis dit : &ldquo;Pourquoi pas après tout !&rdquo;.</p>

<p>J&rsquo;ai donc commencé à refaire toute mon UI (pas beaucoup d&rsquo;écran donc ça va
quand-même) avec <a href="http://www.angularjs.org/">AngularJS</a>. Les premiers écrans sont simples, ça va vite.
Puis arrive le moment tant attendu de l&rsquo;épine dans le pied : un coup de
DELETE http sur une url pour supprimer une entrée. Pas très compliqué&hellip; sauf
que c&rsquo;est pas si simple que ça.</p>

<h2 id="mise-en-place">Mise en place</h2>

<p><a href="http://www.angularjs.org/">AngularJS</a> se met rapide et simplement en place : quelques inclusions de
fichiers JS et le tour est joué.</p>

<ul>
<li>angularjs : la base du framework</li>
<li>angularjs-resource : pour faire du rest</li>
<li>application : le dispatcher d&rsquo;url pour utiliser tel ou tel controller</li>
<li>controlers : les controllers de l&rsquo;application</li>
<li>service : les objets serveur-side portés client-side</li>
</ul>

<p>Évidemment, c&rsquo;est simpliste, mais le but de l&rsquo;article n&rsquo;est pas de faire une
présentation de <a href="http://www.angularjs.org/">AngularJS</a> mais de parler du problème que j&rsquo;ai eu et résolu
ce soir. Pour une meilleure description : <a href="http://thecodersbreakfast.net/index.php?post/2012/07/30/D%C3%A9velopper-une-application-REST-avec-Spring-MVC-Angular.js">Développer une application REST avec
Spring MVC et AngularJS</a>
par <a href="http://twitter.com/OlivierCroisier">Olivier Croisier</a>.</p>

<h2 id="mon-soucis">Mon soucis</h2>

<p>Donc le problème est apparu lorsque j&rsquo;ai voulu faire un appel à la méthode
DELETE sur ma resource. Avec <a href="http://www.angularjs.org/">AngularJS</a> ça se fait comme ça :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">EventListController</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">CodingEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">codingEvents</span> <span class="o">=</span> <span class="nx">CodingEvent</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

    <span class="nx">$scope</span><span class="p">.</span><span class="nx">removeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">codingEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">CodingEvent</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="nx">codingEvent</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>ou comme ça :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">EventListController</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">CodingEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">codingEvents</span> <span class="o">=</span> <span class="nx">CodingEvent</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

    <span class="nx">$scope</span><span class="p">.</span><span class="nx">removeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">codingEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">codingEvent</span><span class="p">.</span><span class="nx">$delete</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="nx">codingEvent</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>mais ça c&rsquo;est la théorie. Car si on utilise ça, tout ce que vous aurez c&rsquo;est
une magnifique</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1</span></pre></td>
<td class="lntd">
<pre class="chroma">DELETE http://localhost:8081/rest/event 405 (Method Not Allowed)</pre></td></tr></table>
</div>
</div>
<p>oui car la méthode DELETE est bindée sur l&rsquo;url <code>/rest/event/{id}</code> donc on ne
touche pas la bonne url. Le problème est étrange, puisque vous avez bien
passé un <code>id</code> (entre accolade dans les codes précédent).</p>

<h2 id="indices">Indices</h2>

<p>Histoire de vous prendre la tête, le problème persiste 2 longues semaines,
vous avez eu le temps de refaire la configuration 3 fois, dont une fois avec
votre gentil collègue qui maintenant parle presque couramment l&rsquo;AngularJS&hellip; mais
rien de rien.</p>

<p>Comme ça pour rire, vous remplacez, un soir de grande fatigue, le <code>codingEvent.id</code>
par un <code>'0'</code> et là, Ô miracle du Javascript, ça fonctionne ! On touche au but..</p>

<h2 id="résolution">Résolution</h2>

<p>Si ça vous saute aux yeux alors bravo, pour les autres (comme moi), un petit
<code>console.log(typeof codingEvent.id);</code> ainsi qu&rsquo;un <code>console.log(typeof '0');</code>
est indispensable. Pas le même type. <code>string</code> dans le premier cas et <code>number</code>
dans le second. Non ça ne peut pas être ça&hellip; Mon service REST prend un Long
en paramètre, et quand je remplace <code>codingEvent.id</code> par <code>'totolabelette'</code>
j&rsquo;ai la belle exception :</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Java" data-lang="Java"><span class="lnt">1</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Java" data-lang="Java"><span class="n">Class</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="n">can</span> <span class="n">not</span> <span class="n">be</span> <span class="n">instantiated</span> <span class="n">using</span> <span class="n">a</span> <span class="n">constructor</span> <span class="n">with</span> <span class="n">a</span> <span class="n">single</span> <span class="n">String</span> <span class="n">argument</span></code></pre></td></tr></table>
</div>
</div>

<p>avec une 404 sur l&rsquo;UI&hellip;</p>

<p>et pourtant si&hellip; remplacez codingEvent.id par codingEvent.id.toString() et
votre appel REST fonctionne parfaitement !!</p>

<p>Mais alors, comment mes GET sur l&rsquo;url <code>/rest/event/{id}</code> pouvaient fonctionner
avant alors que de la même façon le service ne prend qu&rsquo;un Long ? Tout
simplement car je récupère l&rsquo;id de l&rsquo;évènement dans l&rsquo;url de la page via un
<code>$routeParams</code> et que cela renvoi une string, pas un number.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Moralité de mon aventure :</p>

<ul>
<li>débugguer du Javascript c&rsquo;est très palpitant (oui mauvais pour le coeur),</li>
<li>AngularJS n&rsquo;aime pas les numbers !!</li>
</ul>

<p>J&rsquo;espère que cela vous a plu.</p>

  </section>
</article>


</div>

  <footer>
    &copy; Adrien Lecharpentier 2012
  </footer>

</body>
</html>

