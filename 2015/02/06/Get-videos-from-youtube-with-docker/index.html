<html>
<head>
  <meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>alecharp&#39;s blog: Get videos from Youtube with Docker</title>

  <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:200,700" rel="stylesheet" />
  <link rel="stylesheet" media="screen" href="/css/main.css" />
  <link rel="stylesheet" media="screen" href="/css/syntax.css" />
  <link rel="stylesheet" media="screen" href="/css/font-awesome.min.css" />
</head>

<body>

<navbar>
  <div><a href="/" title="alecharp&#39;s blog">alecharp&#39;s blog</a></div>
  <ul>
    <li>
      <a href="//twitter.com/alecharp" title="alecharp's Twitter"><i class="fa fa-twitter"></i></a>
    </li>
    <li>
      <a href="//github.com/alecharp" title="alecharp's Github"><i class="fa fa-github"></i></a>
    </li>
    <li>
      <a href="/index.xml" title="alecharp&#39;s blog's RSS"><i class="fa fa-rss"></i></a>
    </li>
      <li>
        <a href="//speakerdeck.com/alecharp" title="alecharp's SpeakerDeck"><i class="fa fa-slideshare"></i></a>
      </li>
  </ul>
</navbar>


<div id="content">
  

<article>
  <header>
    <h2>Get videos from Youtube with Docker</h2>
  </header>
  <time pubdate="2015-02-06">
    <i class="fa fa-calendar"></i> 2015-02-06
  </time>
  <section>
    

<p>Last week I created my first docker image to be able to get videos from youtube without having to install anything on my computer.</p>

<h2 id="youtube-dl">Youtube-dl</h2>

<p>For a year or two, I used <a href="http://rg3.github.io/youtube-dl/"><code>youtube-dl</code></a> to download any videos from the video platform in order to have a offline version of any videos I&rsquo;d like to watch. This is very useful to watch them in public transport or when you have a bad internet connection.</p>

<p>As I recently change of macbook, I tried to install as few software as possible. The idea was to remove any <code>npm</code>/<code>bower</code> crap. I even extend this to <code>youtube-dl</code>. Why? To reduce the possible issues with <code>brew upgrade</code> or any conflicts with other package manager.</p>

<h2 id="docker-ization">Docker-ization</h2>

<p>There are some <code>youtube-dl</code> based images that can be found on the <a href="https://registry.hub.docker.com/search?q=youtube-dl">docker-registry</a>. But I wanted to create and offer something more. Not that I don&rsquo;t trust unofficial images, but I wanted to base this one on an official one. So let&rsquo;s go for a <code>debian:sid</code>.</p>

<p>I could have just install the <code>youtube-dl</code> binary and set the <code>ENTRYPOINT</code> on it. But, as I said, I wanted to offer something more. So I joined the <code>dl.sh</code> script which will be executed to download the videos. Having such a entrypoint will also enable to add new <em>features</em> on-top of <code>youtube-dl</code>.</p>

<p>That is what I&rsquo;ve done on the version <code>1.1</code>. The first version (1.0) was only able to download the video and audio from the link. On version <code>1.1</code>, there is a <code>--audio</code> parameter to specify that you only want the audio of the following link.</p>

<p>Adding new <em>features</em> will be done only on the <code>dl.sh</code> script without changing the <code>Dockerfile</code>. So the only modifications that will be done on the <code>Dockerfile</code> would be the upgrade of <code>curl</code>, <code>python</code> or <code>ffmpeg</code>.</p>

<p>I can even change the entrypoint from <code>dl.sh</code> to any other script written in any other language, the end users shouldn&rsquo;t notice.</p>

<h2 id="from-unstable-to-stable-and-reproductible">From unstable to stable and reproductible</h2>

<p>I spoke about this image with my friend Olivier Croissier and he said:</p>

<blockquote>
<p>Your image is not really reproductible</p>
</blockquote>

<p>And he&rsquo;s right. Again.</p>

<p>See on my <code>Dockerfile</code>, I run <code>apt-get update &amp;&amp; apt-get upgrade</code>. So from one build to another, I can have a core package version that have change and introduce a bug. It is the same problem when I install <code>curl</code>, <code>python2.7</code> and <code>ffmpeg</code>. Even worst I get the <code>lastest</code> from <code>youtube-dl</code>.</p>

<p>So to make my image stable and reproductible, I have to set the version of each package I want to install. So that I&rsquo;m sure that from one build to another, without changing the <code>Dockerfile</code>, the package used will be the same.</p>

<p>But if you are &ldquo;just&rdquo; using the image, you can use the tags (<code>1.0</code>, <code>1.1</code>, etc.) and those images are fix and won&rsquo;t move.</p>

<h2 id="usage">Usage</h2>

<p>So you can find the script and <code>Dockerfile</code> on Github: <a href="https://github.com/alecharp/get-videos">alecharp/get-videos</a>. And the docker image on the registry: <a href="https://registry.hub.docker.com/u/alecharp/get-videos/">alecharp/get-video</a>.</p>

<p>To use the my image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">docker pull alecharp/get-videos:1.1
docker run --rm -v <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&#34;</span>:/downloads alecharp/get-videos <span class="o">[</span>--audio<span class="o">]</span> URL <span class="o">[</span> <span class="o">[</span>--audio<span class="o">]</span> URL<span class="o">]</span></code></pre></td></tr></table>
</div>
</div>
<p>All the files are downloaded into the volume <code>/downloads</code> of the container. When docker 1.5 will be released, the flag <code>--read-only</code> will be usefull to be sure to store the files on your host, not on the container.</p>

<p>The files are stored into a folder named after the uploader name.</p>

<p>On my git repository, I&rsquo;m using something like the <code>git-flow</code> process so:</p>

<ul>
<li><code>master</code> is stable</li>
<li><code>dev</code> is latest and unstable</li>
</ul>

<p>and I create a tag (<code>git</code> and docker) for every release. I add the changelog in the <code>README.md</code> file that you can see on both Github and Docker registry.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This is my first Docker image. It is not the most useful image of all time as some others already offer to use <code>youtube-dl</code>. But I hope you will like it.</p>

<h2 id="links">Links</h2>

<ul>
<li><a href="http://rg3.github.io/youtube-dl/"><code>youtube-dl</code></a></li>
<li><a href="https://github.com/alecharp/get-videos">Github repository</a></li>
<li><a href="https://registry.hub.docker.com/u/alecharp/get-videos/">Docker image</a></li>
<li>Olivier Croisier:

<ul>
<li><a href="https://twitter.com/OlivierCroisier">@OlivierCroisier</a></li>
<li><a href="http://thecodersbreakfast.net">TheCodersBreakfast.net</a></li>
</ul></li>
</ul>

  </section>
</article>


</div>

  <footer>
    &copy; Adrien Lecharpentier 2012
  </footer>

</body>
</html>

