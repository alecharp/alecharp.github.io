---
layout: post
date: 2014-09-04
author:
  name: Adrien Lecharpentier
  email: adrien.lecharpentier@gmail.com
title: Git fixup quand on connait pas
tags: git
---

Ça va être court: je vais parler de fixup automatique dans Git.

## Pourquoi faire du fixup

Moi je fais du fixup, quand je me rend compte que j'ai oublié un fichier, ou un chunk de code dans un commit, mais pas le dernier. Si c'est le dernier, un `git commit --amend` suffit. Si un ou plusieurs commit(s) se sont intercalés entre deux, alors il faudra faire un `rebase` interactif pour transformer l'hostorique.

## À la main

Il fut un temps pas si lointain[^1] où je faisais du fixup à la main. Dans ce cas, on fait un `git log --oneline` pour trouver le SHA1 du commit à completer, on `git add` ce que l'on a oublié puis on fait `git commit -m "fixup SHA1"`. Pour modifier réellement le commit, on fait un `git rebase -i origin/<branch>` pour déplacer le commit là où ça va bien et on modifie son utisation de `pick` à `f(ixup)`.

[^1]: j'ai appris la bonne façon de faire aujourd'hui!!

## Quand on connait

Le truc c'est que c'est souvent long et chiant. Mais tout ça peut se faire automatiquement.. 

Dans un premier temps, l'option `--autosquash` sur le rebase interactif. Elle permet d'automatiquement réorganiser les commits dans le rebase interatif pour mettre les commit avec comme message `fixup! <SHA1>|"message"` après le commit <SHA1> ou ayant pour message oneline "message" avec l'état `fixup`. Donc plus besoin de modifier à la main le placement des commits de correction. C'est déjà du temps de gagné.

On peut en plus utiliser l'option `--fixup=<SHA1>` sur la commande `git commit` pour préciser que le commit courant va servir de fixup au commit `<SHA1>`. Sachat que `<SHA1>` peut être `HEAD~4` car il va mettre en message de commit le message du commit à corriger.

## Et Voilà!

Avec simplement 2 options à des commandes, mon collègue [Alexandre Garnier](https://twitter.com/zigarn) m'a fait gagner au moins 10min par jour! 

Du même coup, ça c'est retrouver sur mes alias:

 - `git config --global alias.fixup 'commit --fixup'`
 - `git config --global alias.ri 'rebase -i --autosquash'`
